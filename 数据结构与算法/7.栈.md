### 学习之前的问题

&emsp;如果你是Chrome 浏览器的开发工程师，你会如何实现**谷歌浏览器前进后退的功能**？

### 如何理解“栈”？

1. **后进者先出，先进者后出**，这就是典型的“栈”结构。
2. 栈是一种“操作受限”的线性表，只**允许在一端插入和删除数据**
3. 事实上，从功能上来说，**数组或链表确实可以替代栈**，但你要知道，**特定的数据结构是对特定场景的抽象**，而且，**数组或链表暴露了太多的操作接口，操作上的确灵活自由，但使用时就比较不可控**，自然也就更容易出错
4. 当某个数据集合**只涉及在一端插入和删除数据**，并且**满足后进先出、先进后出的特性**，我们就应该**首选“栈”这种数据结构**。

### 如何实现一个“栈”？

&emsp;栈既**可以用数组来实现，也可以用链表来实现**。用**数组实现的栈，我们叫作顺序栈**，用**链表实现的栈，我们叫作链式栈。**

1. 在**入栈和出栈**过程中，只**需要一两个临时变量存储空间**，所以**空间复杂度是 O(1)**
2. **空间复杂度**，是指除了**原本的数据存储空间外**，**算法运行还需要额外的存储空间**

### 支持动态扩容的顺序栈

&emsp;要实现一个支持动态扩容的栈，我们只需要**底层依赖一个支持动态扩容的数组**就可以了, 当**栈满**了之后，我们就**申请一个更大的数组**，将**原来的数据搬移到新数组**中

![](https://ae01.alicdn.com/kf/U22b9e7f614594e20ad03968dfdc4cedb3.jpg)

&emsp;分析一下支持动态扩容的顺序栈的入栈、出栈操作的时间复杂度

- **出栈操作**来说，我们**不会涉及内存的重新申请和数据的搬移**，所以出栈的**时间复杂度仍然是 O(1)**

- **入栈操作**来说，情况就不一样了。当栈中**有空闲空间**时，入栈操作的**时间复杂度为 O(1)**。但当**空间不够**时，就**需要重新申请内存和数据搬移**，所以**时间复杂度就变成了 O(n),** **入栈操作来说，最好情况时间复杂度是 O(1)，最坏情况时间复杂度是 O(n)**

- 先做一些假设和定义

  - **栈空间不够**时，我们**重新申请一个是原来大小两倍的数组**

  - 为了简化分析，**假设只有入栈操作没有出栈操作**

    - 定义**不涉及内存搬移的入栈操作为 simple-push 操作，时间复杂度为 O(1)**

    - 如果**当前栈大小为 K**，**并且已满**，当再**有新的数据要入栈**时，就**需要重新申请 2 倍大小的内存**，**并且做 K 个数据的搬移操作，然后再入栈**。但是，**接下来的 K-1 次入栈操作**，我们**都不需要再重新申请内存和搬移数据**，所以**这 K-1 次入栈操作都只需要一个 simple-push 操作就可以完成**

      ![](https://ae01.alicdn.com/kf/Ua545b34db4d542bd830e6630707335c2Z.jpg)

      &emsp;**这 K 次入栈操作**，总共**涉及了 K 个数据的搬移**，以及 **K 次 simple-push 操作**。将 **K 个数据搬移均摊到 K 次入栈操作**，那**每个入栈操作只需要一个数据搬移和一个 simple-push 操作,** **入栈操作的均摊时间复杂度就为 O(1),** **均摊时间复杂度一般都等于最好情况时间复杂度**

### 栈在函数调用中的应用

&emsp;**操作系统给每个线程分配了一块独立的内存空间**，这块内存**被组织成“栈”这种结构**, 用来**存储函数调用时的临时变量,** 每**进入一个函数**，就会**将临时变量作为一个栈帧入栈**，当**被调用函数执行完成**，**返回之后**，**将这个函数对应的栈帧出栈**

&emsp;将 3+5*8-6 这个表达式的计算过程画成了一张图( **两个栈来解决**的思路)![](https://ae01.alicdn.com/kf/U4e93c14eaad847fca676a10f29a03896x.jpg)

### 栈在括号匹配中的应用

&emsp;假设表达式中只包含**三种括号**，**圆括号 ()、方括号[]和花括号{}**，并且它们**可以任意嵌套**。比如，**{[] ()[{}]}或[{()}([])]等都为合法格式，而{[}()]或[({)]为不合法的格式**

&emsp;我们**用栈来保存未匹配的左括号**，从**左到右依次扫描**字符串。

&emsp;当**扫描到左括号时**，则**将其压入栈**中；当**扫描到右括号**时，从**栈顶取出一个左括号**。如果**能够匹配**，比如“(”跟“)”匹配，“[”跟“]”匹配，“{”跟“}”匹配，**则继续扫描剩下的字符串**。如果**扫描的过程中，遇到不能配对的右括号**，或者**栈中没有数据**，则**说明为非法格式**

### 解答开篇

> 假设你是 Chrome 浏览器的开发工程师，你会如何实现**谷歌浏览器前进后退的功能**？

&emsp;使用**两个栈，X 和 Y**，我们把**首次浏览的页面依次压入栈 X**，当**点击后退按钮时，再依次从栈 X 中出栈**，并**将出栈的数据依次放入栈 Y**。

&emsp;当我们**点击前进按钮时**，我们**依次从栈 Y 中取出数据**，**放入栈 X 中**。

&emsp;当**栈 X 中没有数据**时，那就**说明没有页面可以继续后退浏览**了。当栈 **Y 中没有数据**，那**就说明没有页面可以点击前进按钮浏览**

&emsp;比如你**顺序查看了 a，b，c 三个页面**，我们就**依次把 a，b，c 压入栈**，这个时候，两个栈的数据就是这个样子

![](https://ae01.alicdn.com/kf/Ud0e18d79c4ce43a6bb62468012d2923dX.jpg)

&emsp;当你**通过浏览器的后退按钮**，从**页面 c 后退到页面 a 之后**，我们**就依次把 c 和 b 从栈 X 中弹出**，并且**依次放入到栈 Y**。这个时候，两个栈的数据就是这个样子

![](https://ae01.alicdn.com/kf/Ud06e0f52ad5641748e09d4a466fa9f3dz.jpg)

&emsp;这个时候**你又想看页面 b**，于是你**又点击前进按钮回到 b 页面**，我们**就把 b 再从栈 Y 中出栈**，**放入栈 X** 中。此时两个栈的数据是这个样子

![](https://ae01.alicdn.com/kf/Uc31b7b2859e545f1ae2682ba8aa279ebg.jpg)

&emsp;这个时候，你**通过页面 b 又跳转到新的页面 d** 了，**页面 c 就无法再通过前进、后退按钮重复查看**了，所以**需要清空栈 Y**

![](https://ae01.alicdn.com/kf/U153a4719fe15441cb98f963257dabbab9.jpg)

### 课后思考

1. 我们在讲栈的应用时，讲到用函数调用栈来保存临时变量，为什么函数调用要用“栈”来保存临时变量呢？用其他数据结构不行吗？
2. 我们都知道，JVM 内存管理中有个“堆栈”的概念。栈内存用来存储局部变量和方法调用，堆内存用来存储 Java 中的对象。那 JVM 里面的“栈”跟我们这里说的“栈”是不是一回事呢？如果不是，那它为什么又叫作“栈”呢？

### [栈的仓库](https://github.com/Jakexsc/Algorithm/tree/master/src/com/xsc/stackstudy)
1. [顺序栈](https://github.com/Jakexsc/Algorithm/blob/master/src/com/xsc/stackstudy/ArrayStack.java)
2. [链式栈](https://github.com/Jakexsc/Algorithm/blob/master/src/com/xsc/stackstudy/LinkStack.java)