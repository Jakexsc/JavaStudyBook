### 课前问题

1. **任务的处理速度与线程个数并不是线性正相关**。相反，**过多的线程反而会导致 CPU 频繁切换，处理性能下降**
2. 当我们**向固定大小的线程池中请求一个线程**时，如果**线程池中没有空闲资源**了，这个时候**线程池如何处理这个请求**？是**拒绝请求还是排队请求**？**各种处理策略又是怎么实现的呢**？

### 如何理解“队列”？

1. **先进者先出**，这就是典型的“队列”
2. 最基本的**操作也是两个**：**入队 enqueue()**，放**一个数据到队列尾部**；**出队 dequeue()，从队列头部取一个元素**
3. 队列跟栈一样，也是**一种操作受限的线性表数据结构（ 循环队列、阻塞队列、并发队列）**
4. 高性能队列 **Disruptor、Linux 环形缓存**，都用到了**循环并发队列**；Java concurrent 并发包利用 **ArrayBlockingQueue 来实现公平锁**等

### 顺序队列和链式队列

1. 队列**可以用数组来实现，也可以用链表来实现**
2. **数组实现的队列叫作顺序队列**，用**链表实现的队列叫作链式队列**
3. 确定好**队空和队满**的**判定条件**
4. **循环队列会浪费一个数组的存储空间**

### 阻塞队列和并发队列

1. **阻塞队列**其实就是在**队列基础上增加了阻塞操作**。

   &emsp;简单来说，就是在**队列为空的时候，从队头取数据会被阻塞**。

   &emsp;因为此时还**没有数据可取，直到队列中有了数据才能返回**；如果**队列已经满**了，那么**插入数据的操作就会被阻塞，直到队列中有空闲位置后再插入数据**，**然后再返回**

2. **并发队列**。

   &emsp;最简单直接的实现方式是直接在 enqueue()、dequeue() **方法上加锁**，但是**锁粒度大并发度会比较低，** **同一时刻仅允许一个存或者取操作**

3. 基于**数组的循环队列**，**利用 CAS 原子操作**，可以实现**非常高效的并发队列**。

   &emsp;这也是**循环队列比链式队列应用更加广泛**的原因

### 解答开篇

> 线程池没有空闲线程时，新的任务请求线程资源时，线程池该如何处理？各种处理策略又是如何实现的呢？

#### 有两种处理策略

1. 第一种是**非阻塞的处理方式，直接拒绝任务请求**；
2. 另一种**是阻塞的处理方式，将请求排队，等到有空闲线程时，取出排队的请求继续处理**



#### 如何存储排队的请求？

&emsp;**公平地处理每个排队的请求**，**先进者先服务**，所以**队列这种数据结构很适合来存储排队请求**



#### 基于**链表和基于数组**这两种实现方式。这**两种实现方式对于排队请求又有什么区别**呢？

1. **基于链表**的实现方式，可以实现一个**支持无限排队的无界队列**（unbounded queue），但是**可能会导致过多的请求排队等待**，**请求处理的响应时间过长**。所以，针对**响应时间比较敏感的系统**，基于**链表实现的无限排队的线程池是不合适**的
2. 基于**数组实现的有界队列**（bounded queue），**队列的大小有限**，所以**线程池中排队的请求超过队列大小时**，**接下来的请求就会被拒绝**，这种方式**对响应时间敏感的系统**来说，就**相对更加合理**。不过，**设置一个合理的队列大小，也是非常有讲究的**。**队列太大导致等待的请求太多**，**队列太小会导致无法充分利用系统资源、发挥最大性能**队列**可以应用在任何有限资源池**中，**用于排队请求，比如数据库连接池**等。**实际上，对于大部分资源有限的场景，当没有空闲资源时，基本上都可以通过“队列”这种数据结构来实现请求排队**

### 课后思考

&emsp;除了线程池这种池结构会用到队列排队请求，你还知道有哪些类似的池结构或者场景中会用到队列的排队请求呢？

> **分布式应用中的消息队列，也是一种队列结构**

&emsp;关于如何实现无锁并发队列，网上有非常多的讨论。对这个问题，你怎么看呢？

### [队列的仓库](https://github.com/Jakexsc/Algorithm/tree/master/src/com/xsc/queuestudy)

1. [循环队列](https://github.com/Jakexsc/Algorithm/blob/master/src/com/xsc/queuestudy/ListQueue.java)

2. [链式队列](https://github.com/Jakexsc/Algorithm/blob/master/src/com/xsc/queuestudy/LinkQueue.java)